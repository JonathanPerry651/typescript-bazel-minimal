<!DOCTYPE html>
<html>

<head>
    <title>Silent Auth</title>
</head>

<body>
    <script>
        (function () {
            // Parse query parameters for 'code' (Authorization Code Flow)
            // Note: PKCE returns code in query string, Implicit returns token in hash.
            var params = new URLSearchParams(window.location.search);
            var code = params.get('code');

            if (code) {
                // Check if running in Popup (opener) or Iframe (parent)
                var targetWindow = window.opener || window.parent;

                if (targetWindow && targetWindow !== window) {
                    console.log("[SilentAuth] Posting auth code to parent/opener");
                    targetWindow.postMessage({
                        type: 'AUTH_CODE',
                        code: code
                    }, window.location.origin); // Restrict to same origin

                    // If in a popup, close self
                    if (window.opener) {
                        window.close();
                    }
                } else {
                    console.error("[SilentAuth] No parent/opener found to post message to.");
                }
            } else {
                console.error("[SilentAuth] No code found in query parameters");
                document.body.innerText = "Error: Authentication failed (no code).";
            }
        })();
    </script>
</body>

</html>