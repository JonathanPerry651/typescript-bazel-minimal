<!DOCTYPE html>
<html>

<head>
    <title>Silent Auth</title>
</head>

<body>
    <script>
        (function () {
            // Extract access_token from hash: #access_token=...
            var hash = window.location.hash;
            if (hash) {
                var params = new URLSearchParams(hash.substring(1)); // remove #
                var token = params.get('access_token');

                if (token) {
                    // Check if running in Popup (opener) or Iframe (parent)
                    var targetWindow = window.opener || window.parent;

                    if (targetWindow && targetWindow !== window) {
                        console.log("[SilentAuth] Posting token to parent/opener");
                        targetWindow.postMessage({
                            type: 'AUTH_TOKEN',
                            token: token
                        }, window.location.origin); // Restrict to same origin

                        // If in a popup, close self
                        if (window.opener) {
                            window.close();
                        }
                    } else {
                        console.error("[SilentAuth] No parent/opener found to post message to.");
                    }
                } else {
                    console.error("[SilentAuth] No access_token found in hash");
                }
            } else {
                console.error("[SilentAuth] No hash fragment found");
            }
        })();
    </script>
</body>

</html>